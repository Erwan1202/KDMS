---
import { Image } from "astro:assets";
import logoBlack from "/src/assets/common/logo-black.png";
import logoWhite from "/src/assets/common/logo-white.png";

interface Props {
    theme?: "light" | "dark";
}

const { theme = "light" } = Astro.props;

const isDark = theme === "dark";
const currentPath = Astro.url.pathname;
---

<nav
    class={`navbar-bg fixed top-0 left-0 right-0 z-50 w-full h-25 px-4 flex items-center transition-all duration-75 ease-out ${isDark ? "bg-black" : "bg-transparent"}`}
>
    <a href="/" class="flex items-center relative">
        <Image
            src={logoBlack}
            alt="KDMS"
            loading="eager"
            class={`logo-black h-24 w-auto transition-opacity duration-300 ${isDark ? "opacity-0" : "opacity-100"}`}
        />
        <Image
            src={logoWhite}
            alt="KDMS"
            loading="eager"
            class={`logo-white h-24 w-auto transition-opacity duration-300 absolute left-0 top-0 ${isDark ? "opacity-100" : "opacity-0"}`}
        />
    </a>

    <div
        class="nav-links-container w-full max-w-5xl px-8 hidden lg:grid grid-cols-4 items-center absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 group/nav"
    >
        <div class="justify-self-center">
            <a
                href="/"
                class={`nav-link text-lg font-medium transition-colors duration-300 no-underline relative group ${isDark ? "text-white" : "text-black"}`}
            >
                Accueil
                <span
                    class={`nav-underline absolute bottom-0 left-0 h-0.5 bg-current transition-all duration-300 ${currentPath === "/" ? "w-full group-hover/nav:w-0" : "w-0"} group-hover:!w-full`}
                ></span>
            </a>
        </div>
        <div class="justify-self-center">
            <a
                href="/savoir-faire"
                class={`nav-link text-lg font-medium transition-colors duration-300 no-underline relative group ${isDark ? "text-white" : "text-black"}`}
            >
                Notre Savoir Faire
                <span
                    class={`nav-underline absolute bottom-0 left-0 h-0.5 bg-current transition-all duration-300 ${currentPath === "/savoir-faire" || currentPath === "/savoir-faire/" ? "w-full group-hover/nav:w-0" : "w-0"} group-hover:!w-full`}
                ></span>
            </a>
        </div>

        <div class="justify-self-center">
            <a
                href="/#realisations"
                class={`nav-link text-lg font-medium transition-colors duration-300 no-underline relative group ${isDark ? "text-white" : "text-black"}`}
            >
                Nos Réalisations
                <span
                    class={`nav-underline absolute bottom-0 left-0 h-0.5 bg-current transition-all duration-300 ${currentPath === "/realisations" || currentPath === "/realisations/" ? "w-full group-hover/nav:w-0" : "w-0"} group-hover:!w-full`}
                ></span>
            </a>
        </div>

        <div class="justify-self-center">
            <a
                href="/contact"
                class={`nav-link text-lg font-medium transition-colors duration-300 no-underline relative group ${isDark ? "text-white" : "text-black"}`}
            >
                Contact
                <span
                    class={`nav-underline absolute bottom-0 left-0 h-0.5 bg-current transition-all duration-300 ${currentPath === "/contact" || currentPath === "/contact/" ? "w-full group-hover/nav:w-0" : "w-0"} group-hover:!w-full`}
                ></span>
            </a>
        </div>
    </div>

    <button
        id="mobile-menu-btn"
        class="lg:hidden absolute right-8 top-1/2 -translate-y-1/2 z-50 p-2 bg-transparent border-none outline-none focus:outline-none"
        aria-label="Menu"
    >
        <div class="w-6 h-4.5 flex flex-col justify-between">
            <span
                class={`w-full h-0.5 transition-all duration-300 origin-left ${isDark ? "bg-white" : "bg-black"}`}
            ></span>
            <span
                class={`w-full h-0.5 transition-all duration-300 opacity-100 ${isDark ? "bg-white" : "bg-black"}`}
            ></span>
            <span
                class={`w-full h-0.5 transition-all duration-300 origin-left ${isDark ? "bg-white" : "bg-black"}`}
            ></span>
        </div>
    </button>

    <div
        id="mobile-menu"
        class="fixed inset-0 bg-white z-40 translate-x-full transition-transform duration-500 ease-in-out flex flex-col items-center justify-center gap-8 lg:hidden group/mobile"
    >
        <a
            href="/"
            class="text-black text-3xl font-bold nav-link-mobile relative group"
        >
            Accueil
            <span
                class={`absolute bottom-0 left-0 h-0.5 bg-current transition-all duration-300 ${currentPath === "/" ? "w-full group-hover/mobile:w-0" : "w-0"} group-hover:!w-full`}
            ></span>
        </a>
        <a
            href="/savoir-faire"
            class="text-black text-3xl font-bold nav-link-mobile relative group"
        >
            Notre Savoir Faire
            <span
                class={`absolute bottom-0 left-0 h-0.5 bg-current transition-all duration-300 ${currentPath === "/savoir-faire" || currentPath === "/savoir-faire/" ? "w-full group-hover/mobile:w-0" : "w-0"} group-hover:!w-full`}
            ></span>
        </a>
        <a
            href="/#realisations"
            class="text-black text-3xl font-bold nav-link-mobile relative group"
        >
            Nos Réalisations
            <span
                class={`absolute bottom-0 left-0 h-0.5 bg-current transition-all duration-300 ${currentPath === "/realisations" || currentPath === "/realisations/" ? "w-full group-hover/mobile:w-0" : "w-0"} group-hover:!w-full`}
            ></span>
        </a>
        <a
            href="/contact"
            class="text-black text-3xl font-bold nav-link-mobile relative group"
        >
            Contact
            <span
                class={`absolute bottom-0 left-0 h-0.5 bg-current transition-all duration-300 ${currentPath === "/contact" || currentPath === "/contact/" ? "w-full group-hover/mobile:w-0" : "w-0"} group-hover:!w-full`}
            ></span>
        </a>
    </div>
</nav>

<script>
    const menuBtn = document.getElementById("mobile-menu-btn");
    const mobileMenu = document.getElementById("mobile-menu");
    const spans = menuBtn?.querySelectorAll("span");
    const body = document.body;
    let isOpen = false;

    const heroSection = document.querySelector("#hero-section");
    if (heroSection) {
        window.addEventListener("scroll", () => {
            const scrollValues = heroSection.getBoundingClientRect();
            const progress = Math.abs(scrollValues.top) / window.innerHeight;

            if (progress > 0.8 && !isOpen) {
                spans?.forEach((span) =>
                    span.classList.replace("bg-black", "bg-white"),
                );
            } else {
                if (!isOpen) {
                    spans?.forEach((span) =>
                        span.classList.replace("bg-white", "bg-black"),
                    );
                }
            }
        });
    }

    menuBtn?.addEventListener("click", () => {
        isOpen = !isOpen;

        if (isOpen) {
            mobileMenu?.classList.remove("translate-x-full");
            body.style.overflow = "hidden";

            spans?.[0].classList.add("rotate-45");
            spans?.[1].classList.add("opacity-0");
            spans?.[2].classList.add("-rotate-45");

            spans?.forEach((span) => {
                span.classList.remove("bg-white");
                span.classList.add("bg-black");
            });
        } else {
            mobileMenu?.classList.add("translate-x-full");
            body.style.overflow = "";

            spans?.[0].classList.remove("rotate-45");
            spans?.[1].classList.remove("opacity-0");
            spans?.[2].classList.remove("-rotate-45");
            const scrollValues = heroSection?.getBoundingClientRect();
            const progress = scrollValues
                ? Math.abs(scrollValues.top) / window.innerHeight
                : 0;

            spans?.forEach((span) => {
                if (progress > 0.8) {
                    span.classList.add("bg-white");
                    span.classList.remove("bg-black");
                } else {
                    span.classList.add("bg-black");
                    span.classList.remove("bg-white");
                }
            });
        }
    });

    document.querySelectorAll(".nav-link-mobile").forEach((link) => {
        link.addEventListener("click", () => {
            isOpen = false;
            mobileMenu?.classList.add("translate-x-full");
            body.style.overflow = "";
            spans?.[0].classList.remove("rotate-45");
            spans?.[1].classList.remove("opacity-0");
            spans?.[2].classList.remove("-rotate-45");

            const scrollValues = heroSection?.getBoundingClientRect();
            const progress = scrollValues
                ? Math.abs(scrollValues.top) / window.innerHeight
                : 0;
            spans?.forEach((span) => {
                if (progress > 0.8) {
                    span.classList.add("bg-white");
                    span.classList.remove("bg-black");
                } else {
                    span.classList.add("bg-black");
                    span.classList.remove("bg-white");
                }
            });
        });
    });
</script>
