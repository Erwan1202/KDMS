---
import { Image } from "astro:assets";
import logoBlack from "/src/assets/common/logo-black.png";
import logoWhite from "/src/assets/common/logo-white.png";

const currentPath = Astro.url.pathname;
---

<nav
    class="fixed top-0 left-0 right-0 z-50 w-full h-16 md:h-24 px-4 flex items-center transition-all duration-75 ease-out bg-transparent"
>
    <div
        class={`navbar-bg absolute inset-0 bg-[#0E0E0E] -z-10 transition-all duration-300 ${currentPath === "/" ? "opacity-0 invisible" : ""}`}
    >
    </div>
    <a href="/" class="flex items-center relative">
        <Image
            src={logoBlack}
            alt="KDMS"
            loading="eager"
            height={80}
            class="logo-black h-12 md:h-20 w-auto transition-opacity duration-300 opacity-0"
        />
        <Image
            src={logoWhite}
            alt="KDMS"
            loading="eager"
            height={80}
            class="logo-white h-12 md:h-20 w-auto transition-opacity duration-300 absolute left-0 top-0 opacity-100"
        />
    </a>

    <div
        class="nav-links-container w-full max-w-5xl px-4 md:px-8 hidden lg:grid grid-cols-4 items-center absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 group/nav"
    >
        <div class="justify-self-center">
            <a
                href="/"
                class={`nav-link text-base lg:text-lg xl:text-xl font-medium transition-colors duration-300 no-underline relative group hover:text-[#4A5D23] ${currentPath === "/" ? "text-[#4A5D23]" : "text-[#B8B8B8]"}`}
            >
                Accueil
                <span
                    class={`nav-underline absolute bottom-0 left-0 h-0.5 bg-[#4A5D23] transition-all duration-300 group-hover:w-full ${currentPath === "/" ? "w-full" : "w-0"}`}
                ></span>
            </a>
        </div>
        <div class="justify-self-center">
            <a
                href="/expertise"
                class={`nav-link text-base lg:text-lg xl:text-xl font-medium transition-colors duration-300 no-underline relative group hover:text-[#4A5D23] ${currentPath === "/expertise" || currentPath === "/expertise/" ? "text-[#4A5D23]" : "text-[#B8B8B8]"}`}
            >
                Notre expertise
                <span
                    class={`nav-underline absolute bottom-0 left-0 h-0.5 bg-[#4A5D23] transition-all duration-300 group-hover:w-full ${currentPath === "/expertise" || currentPath === "/expertise/" ? "w-full" : "w-0"}`}
                ></span>
            </a>
        </div>

        <div class="justify-self-center">
            <a
                href="/realisations"
                class={`nav-link text-base lg:text-lg xl:text-xl font-medium transition-colors duration-300 no-underline relative group hover:text-[#4A5D23] ${currentPath === "/realisations" || currentPath === "/realisations/" ? "text-[#4A5D23]" : "text-[#B8B8B8]"}`}
            >
                Nos Réalisations
                <span
                    class={`nav-underline absolute bottom-0 left-0 h-0.5 bg-[#4A5D23] transition-all duration-300 group-hover:w-full ${currentPath === "/realisations" || currentPath === "/realisations/" ? "w-full" : "w-0"}`}
                ></span>
            </a>
        </div>

        <div class="justify-self-center">
            <a
                href="/contact"
                class={`nav-link text-base lg:text-lg xl:text-xl font-medium transition-colors duration-300 no-underline relative group hover:text-[#4A5D23] ${currentPath === "/contact" || currentPath === "/contact/" ? "text-[#4A5D23]" : "text-[#B8B8B8]"}`}
            >
                Contact
                <span
                    class={`nav-underline absolute bottom-0 left-0 h-0.5 bg-[#4A5D23] transition-all duration-300 group-hover:w-full ${currentPath === "/contact" || currentPath === "/contact/" ? "w-full" : "w-0"}`}
                ></span>
            </a>
        </div>
    </div>

    <button
        id="mobile-menu-btn"
        class="lg:hidden absolute right-8 top-1/2 -translate-y-1/2 z-50 p-2 bg-transparent border-none outline-none focus:outline-none"
        aria-label="Menu"
    >
        <div class="w-6 h-5 flex flex-col justify-between relative">
            <span
                class="burger-line w-full h-0.5 transition-all duration-300 ease-in-out bg-white absolute top-0 left-0"
            ></span>
            <span
                class="burger-line w-full h-0.5 transition-all duration-300 ease-in-out bg-white absolute top-1/2 -translate-y-1/2 left-0"
            ></span>
            <span
                class="burger-line w-full h-0.5 transition-all duration-300 ease-in-out bg-white absolute bottom-0 left-0"
            ></span>
        </div>
    </button>

    <div
        id="mobile-menu"
        class="fixed inset-0 bg-[#0E0E0E] z-40 translate-x-full transition-transform duration-500 ease-in-out flex flex-col items-center justify-center gap-8 lg:hidden group/mobile"
    >
        <a
            href="/"
            class={`hover:text-[#4A5D23] text-3xl sm:text-4xl font-bold nav-link-mobile relative group ${currentPath === "/" ? "text-[#4A5D23]" : "text-[#B8B8B8]"}`}
        >
            Accueil
            <span
                class={`absolute bottom-0 left-0 h-0.5 bg-[#4A5D23] transition-all duration-300 group-hover:w-full ${currentPath === "/" ? "w-full" : "w-0"}`}
            ></span>
        </a>
        <a
            href="/expertise"
            class={`hover:text-[#4A5D23] text-3xl sm:text-4xl font-bold nav-link-mobile relative group ${currentPath === "/expertise" || currentPath === "/expertise/" ? "text-[#4A5D23]" : "text-[#B8B8B8]"}`}
        >
            Notre expertise
            <span
                class={`absolute bottom-0 left-0 h-0.5 bg-[#4A5D23] transition-all duration-300 group-hover:w-full ${currentPath === "/expertise" || currentPath === "/expertise/" ? "w-full" : "w-0"}`}
            ></span>
        </a>
        <a
            href="/realisations"
            class={`hover:text-[#4A5D23] text-3xl sm:text-4xl font-bold nav-link-mobile relative group ${currentPath === "/realisations" || currentPath === "/realisations/" ? "text-[#4A5D23]" : "text-[#B8B8B8]"}`}
        >
            Nos Réalisations
            <span
                class={`absolute bottom-0 left-0 h-0.5 bg-[#4A5D23] transition-all duration-300 group-hover:w-full ${currentPath === "/realisations" || currentPath === "/realisations/" ? "w-full" : "w-0"}`}
            ></span>
        </a>
        <a
            href="/contact"
            class={`hover:text-[#4A5D23] text-3xl sm:text-4xl font-bold nav-link-mobile relative group ${currentPath === "/contact" || currentPath === "/contact/" ? "text-[#4A5D23]" : "text-[#B8B8B8]"}`}
        >
            Contact
            <span
                class={`absolute bottom-0 left-0 h-0.5 bg-[#4A5D23] transition-all duration-300 group-hover:w-full ${currentPath === "/contact" || currentPath === "/contact/" ? "w-full" : "w-0"}`}
            ></span>
        </a>
    </div>

    <script>
        const menuBtn = document.getElementById("mobile-menu-btn");
        const mobileMenu = document.getElementById("mobile-menu");
        const spans = menuBtn?.querySelectorAll(".burger-line");
        const body = document.body;
        let isOpen = false;

        menuBtn?.addEventListener("click", () => {
            isOpen = !isOpen;

            if (isOpen) {
                mobileMenu?.classList.remove("translate-x-full");
                body.style.overflow = "hidden";

                if (spans && spans.length >= 3) {
                    (spans[0] as HTMLElement).style.transform = "translateY(10px) rotate(45deg)";
                    (spans[1] as HTMLElement).style.opacity = "0";
                    (spans[1] as HTMLElement).style.transform = "translateX(-10px)";
                    (spans[2] as HTMLElement).style.transform = "translateY(-10px) rotate(-45deg)";
                }
            } else {
                mobileMenu?.classList.add("translate-x-full");
                body.style.overflow = "";

                if (spans && spans.length >= 3) {
                    (spans[0] as HTMLElement).style.transform = "";
                    (spans[1] as HTMLElement).style.opacity = "1";
                    (spans[1] as HTMLElement).style.transform = "";
                    (spans[2] as HTMLElement).style.transform = "";
                }
            }
        });

        document.querySelectorAll(".nav-link-mobile").forEach((link) => {
            link.addEventListener("click", () => {
                isOpen = false;
                mobileMenu?.classList.add("translate-x-full");
                body.style.overflow = "";
                if (spans && spans.length >= 3) {
                    (spans[0] as HTMLElement).style.transform = "";
                    (spans[1] as HTMLElement).style.opacity = "1";
                    (spans[1] as HTMLElement).style.transform = "";
                    (spans[2] as HTMLElement).style.transform = "";
                }
            });
        });
    </script>
</nav>
