---
import { Image } from "astro:assets";
import logoBlack from "/src/assets/common/logo-black.png";
import logoWhite from "/src/assets/common/logo-white.png";

const currentPath = Astro.url.pathname;
---

<nav
    class="fixed top-0 left-0 right-0 z-50 w-full h-16 md:h-24 px-4 flex items-center transition-all duration-75 ease-out bg-transparent"
>
    <div
        class={`navbar-bg absolute inset-0 bg-[#0E0E0E] -z-10 transition-all duration-300 ${currentPath === "/" ? "opacity-0 invisible" : ""}`}
    >
    </div>
    <a href="/" class="flex items-center relative">
        <Image
            src={logoBlack}
            alt="KDMS"
            loading="eager"
            height={80}
            class="logo-black h-12 md:h-20 w-auto transition-opacity duration-300 opacity-0"
        />
        <Image
            src={logoWhite}
            alt="KDMS"
            loading="eager"
            height={80}
            class="logo-white h-12 md:h-20 w-auto transition-opacity duration-300 absolute left-0 top-0 opacity-100"
        />
    </a>

    <div
        class="nav-links-container w-full max-w-5xl px-8 hidden lg:grid grid-cols-4 items-center absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 group/nav"
    >
        <div class="justify-self-center">
            <a
                href="/"
                class={`nav-link text-xl font-medium transition-colors duration-300 no-underline relative group hover:text-[#4A5D23] ${currentPath === "/" ? "text-[#4A5D23]" : "text-[#B8B8B8]"}`}
            >
                Accueil
                <span
                    class={`nav-underline absolute bottom-0 left-0 h-0.5 bg-[#4A5D23] transition-all duration-300 group-hover:w-full ${currentPath === "/" ? "w-full" : "w-0"}`}
                ></span>
            </a>
        </div>
        <div class="justify-self-center">
            <a
                href="/expertise"
                class={`nav-link text-xl font-medium transition-colors duration-300 no-underline relative group hover:text-[#4A5D23] ${currentPath === "/expertise" || currentPath === "/expertise/" ? "text-[#4A5D23]" : "text-[#B8B8B8]"}`}
            >
                Notre expertise
                <span
                    class={`nav-underline absolute bottom-0 left-0 h-0.5 bg-[#4A5D23] transition-all duration-300 group-hover:w-full ${currentPath === "/savoir-faire" || currentPath === "/savoir-faire/" ? "w-full" : "w-0"}`}
                    class={`nav-underline absolute bottom-0 left-0 h-0.5 bg-[#4A5D23] transition-all duration-300 ${currentPath === "/expertise" || currentPath === "/expertise/" ? "w-full group-hover/nav:w-0" : "w-0"} group-hover:!w-full`}
                ></span>
            </a>
        </div>

        <div class="justify-self-center">
            <a
                href="/realisations"
                class={`nav-link text-lg font-medium transition-colors duration-300 no-underline relative group hover:text-[#4A5D23] ${currentPath === "/realisations" || currentPath === "/realisations/" ? "text-[#4A5D23]" : "text-[#B8B8B8]"}`}
            >
                Nos Réalisations
                <span
                    class={`nav-underline absolute bottom-0 left-0 h-0.5 bg-[#4A5D23] transition-all duration-300 group-hover:w-full ${currentPath === "/realisations" || currentPath === "/realisations/" ? "w-full" : "w-0"}`}
                ></span>
            </a>
        </div>

        <div class="justify-self-center">
            <a
                href="/contact"
                class={`nav-link text-xl font-medium transition-colors duration-300 no-underline relative group hover:text-[#4A5D23] ${currentPath === "/contact" || currentPath === "/contact/" ? "text-[#4A5D23]" : "text-[#B8B8B8]"}`}
            >
                Contact
                <span
                    class={`nav-underline absolute bottom-0 left-0 h-0.5 bg-[#4A5D23] transition-all duration-300 group-hover:w-full ${currentPath === "/contact" || currentPath === "/contact/" ? "w-full" : "w-0"}`}
                ></span>
            </a>
        </div>
    </div>

    <button
        id="mobile-menu-btn"
        class="lg:hidden absolute right-8 top-1/2 -translate-y-1/2 z-50 p-2 bg-transparent border-none outline-none focus:outline-none"
        aria-label="Menu"
    >
        <div class="w-6 h-4.5 flex flex-col justify-between">
            <span
                class="w-full h-0.5 transition-all duration-300 origin-left bg-white group-hover:bg-[#4A5D23]"
            ></span>
            <span
                class="w-full h-0.5 transition-all duration-300 opacity-100 bg-white group-hover:bg-[#4A5D23]"
            ></span>
            <span
                class="w-full h-0.5 transition-all duration-300 origin-left bg-white group-hover:bg-[#4A5D23]"
            ></span>
        </div>
    </button>

    <div
        id="mobile-menu"
        class="fixed inset-0 bg-[#0E0E0E] z-40 translate-x-full transition-transform duration-500 ease-in-out flex flex-col items-center justify-center gap-8 lg:hidden group/mobile"
    >
        <a
            href="/"
            class={`hover:text-[#4A5D23] text-4xl font-bold nav-link-mobile relative group ${currentPath === "/" ? "text-[#4A5D23]" : "text-[#B8B8B8]"}`}
        >
            Accueil
            <span
                class={`absolute bottom-0 left-0 h-0.5 bg-[#4A5D23] transition-all duration-300 group-hover:w-full ${currentPath === "/" ? "w-full" : "w-0"}`}
            ></span>
        </a>
        <a
            href="/expertise"
            class={`hover:text-[#4A5D23] text-4xl font-bold nav-link-mobile relative group ${currentPath === "/expertise" || currentPath === "/expertise/" ? "text-[#4A5D23]" : "text-[#B8B8B8]"}`}
        >
            Notre expertise
            <span
                class={`absolute bottom-0 left-0 h-0.5 bg-[#4A5D23] transition-all duration-300 group-hover:w-full ${currentPath === "/savoir-faire" || currentPath === "/savoir-faire/" ? "w-full" : "w-0"}`}
                class={`absolute bottom-0 left-0 h-0.5 bg-[#4A5D23] transition-all duration-300 ${currentPath === "/expertise" || currentPath === "/expertise/" ? "w-full group-hover/mobile:w-0" : "w-0"} group-hover:!w-full`}
            ></span>https://github.com/Erwan1202/KDMS/pull/25/conflict?name=src%252Fcomponents%252Fcommon%252FNavbar.astro&ancestor_oid=4e338763e6a2fb2c50e8916733891fd68d72f060&base_oid=870047e631ad8f330e11bdf98bae90f01c1096e2&head_oid=ba11e30cf9d3090795e3c39e87759e333e355f1f
        </a>
        <a
            href="/realisations"
            class={`hover:text-[#4A5D23] text-3xl font-bold nav-link-mobile relative group ${currentPath === "/realisations" || currentPath === "/realisations/" ? "text-[#4A5D23]" : "text-[#B8B8B8]"}`}
        >
            Nos Réalisations
            <span
                class={`absolute bottom-0 left-0 h-0.5 bg-[#4A5D23] transition-all duration-300 group-hover:w-full ${currentPath === "/realisations" || currentPath === "/realisations/" ? "w-full" : "w-0"}`}
            ></span>
        </a>
        <a
            href="/contact"
            class={`hover:text-[#4A5D23] text-4xl font-bold nav-link-mobile relative group ${currentPath === "/contact" || currentPath === "/contact/" ? "text-[#4A5D23]" : "text-[#B8B8B8]"}`}
        >
            Contact
            <span
                class={`absolute bottom-0 left-0 h-0.5 bg-[#4A5D23] transition-all duration-300 group-hover:w-full ${currentPath === "/contact" || currentPath === "/contact/" ? "w-full" : "w-0"}`}
            ></span>
        </a>
    </div>

    <script>
        const menuBtn = document.getElementById("mobile-menu-btn");
        const mobileMenu = document.getElementById("mobile-menu");
        const spans = menuBtn?.querySelectorAll("span");
        const body = document.body;
        let isOpen = false;

        menuBtn?.addEventListener("click", () => {
            isOpen = !isOpen;

            if (isOpen) {
                mobileMenu?.classList.remove("translate-x-full");
                body.style.overflow = "hidden";

                spans?.[0].classList.add("rotate-45");
                spans?.[1].classList.add("opacity-0");
                spans?.[2].classList.add("-rotate-45");

                // Ensure spans are white on black background
                spans?.forEach((span) => {
                    span.classList.add("bg-white");
                    span.classList.remove("bg-black");
                });
            } else {
                mobileMenu?.classList.add("translate-x-full");
                body.style.overflow = "";

                spans?.[0].classList.remove("rotate-45");
                spans?.[1].classList.remove("opacity-0");
                spans?.[2].classList.remove("-rotate-45");

                // Ensure spans remain white
                spans?.forEach((span) => {
                    span.classList.add("bg-white");
                    span.classList.remove("bg-black");
                });
            }
        });

        document.querySelectorAll(".nav-link-mobile").forEach((link) => {
            link.addEventListener("click", () => {
                isOpen = false;
                mobileMenu?.classList.add("translate-x-full");
                body.style.overflow = "";
                spans?.[0].classList.remove("rotate-45");
                spans?.[1].classList.remove("opacity-0");
                spans?.[2].classList.remove("-rotate-45");

                // Ensure spans remain white
                spans?.forEach((span) => {
                    span.classList.add("bg-white");
                    span.classList.remove("bg-black");
                });
            });
        });
    </script>
</nav>
