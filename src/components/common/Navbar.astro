---
import { Image } from "astro:assets";
import logoBlack from "/src/assets/common/logo-black.png";
import logoWhite from "/src/assets/common/logo-white.png";

// Always force "dark" theme (White text/logo) for the new design
const isDark = true;
const currentPath = Astro.url.pathname;
---

<nav
    class="navbar-bg fixed top-0 left-0 right-0 z-50 w-full h-16 md:h-24 px-4 flex items-center transition-all duration-75 ease-out bg-transparent"
>
    <a href="/" class="flex items-center relative">
        <Image
            src={logoBlack}
            alt="KDMS"
            loading="eager"
            height={80}
            class="logo-black h-12 md:h-20 w-auto transition-opacity duration-300 opacity-0"
        />
        <Image
            src={logoWhite}
            alt="KDMS"
            loading="eager"
            height={80}
            class="logo-white h-12 md:h-20 w-auto transition-opacity duration-300 absolute left-0 top-0 opacity-100"
        />
    </a>

    <div
        class="nav-links-container w-full max-w-5xl px-8 hidden lg:grid grid-cols-4 items-center absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 group/nav"
    >
        <div class="justify-self-center">
            <a
                href="/"
                class="nav-link text-xl font-medium transition-colors duration-300 no-underline relative group text-[#B8B8B8] hover:text-[#5C8F3A]"
            >
                Accueil
                <span
                    class={`nav-underline absolute bottom-0 left-0 h-0.5 bg-[#5C8F3A] transition-all duration-300 ${currentPath === "/" ? "w-full group-hover/nav:w-0" : "w-0"} group-hover:!w-full`}
                ></span>
            </a>
        </div>
        <div class="justify-self-center">
            <a
                href="/savoir-faire"
                class="nav-link text-xl font-medium transition-colors duration-300 no-underline relative group text-[#B8B8B8] hover:text-[#5C8F3A]"
            >
                Notre Savoir Faire
                <span
                    class={`nav-underline absolute bottom-0 left-0 h-0.5 bg-[#5C8F3A] transition-all duration-300 ${currentPath === "/savoir-faire" || currentPath === "/savoir-faire/" ? "w-full group-hover/nav:w-0" : "w-0"} group-hover:!w-full`}
                ></span>
            </a>
        </div>

        <div class="justify-self-center">
            <a
                href="/realisations"
                class="nav-link text-lg font-medium transition-colors duration-300 no-underline relative group text-[#B8B8B8] hover:text-[#5C8F3A]"
            >
                Nos Réalisations
                <span
                    class={`nav-underline absolute bottom-0 left-0 h-0.5 bg-[#5C8F3A] transition-all duration-300 ${currentPath === "/realisations" || currentPath === "/realisations/" ? "w-full group-hover/nav:w-0" : "w-0"} group-hover:!w-full`}
                ></span>
            </a>
        </div>

        <div class="justify-self-center">
            <a
                href="/contact"
                class="nav-link text-xl font-medium transition-colors duration-300 no-underline relative group text-[#B8B8B8] hover:text-[#5C8F3A]"
            >
                Contact
                <span
                    class={`nav-underline absolute bottom-0 left-0 h-0.5 bg-[#5C8F3A] transition-all duration-300 ${currentPath === "/contact" || currentPath === "/contact/" ? "w-full group-hover/nav:w-0" : "w-0"} group-hover:!w-full`}
                ></span>
            </a>
        </div>
    </div>

    <button
        id="mobile-menu-btn"
        class="lg:hidden absolute right-8 top-1/2 -translate-y-1/2 z-50 p-2 bg-transparent border-none outline-none focus:outline-none"
        aria-label="Menu"
    >
        <div class="w-6 h-4.5 flex flex-col justify-between">
            <span
                class="w-full h-0.5 transition-all duration-300 origin-left bg-white group-hover:bg-[#5C8F3A]"
            ></span>
            <span
                class="w-full h-0.5 transition-all duration-300 opacity-100 bg-white group-hover:bg-[#5C8F3A]"
            ></span>
            <span
                class="w-full h-0.5 transition-all duration-300 origin-left bg-white group-hover:bg-[#5C8F3A]"
            ></span>
        </div>
    </button>

    <div
        id="mobile-menu"
        class="fixed inset-0 bg-[#0E0E0E] z-40 translate-x-full transition-transform duration-500 ease-in-out flex flex-col items-center justify-center gap-8 lg:hidden group/mobile"
    >
        <a
            href="/"
            class="text-[#B8B8B8] hover:text-[#5C8F3A] text-4xl font-bold nav-link-mobile relative group"
        >
            Accueil
            <span
                class={`absolute bottom-0 left-0 h-0.5 bg-[#5C8F3A] transition-all duration-300 ${currentPath === "/" ? "w-full group-hover/mobile:w-0" : "w-0"} group-hover:!w-full`}
            ></span>
        </a>
        <a
            href="/savoir-faire"
            class="text-[#B8B8B8] hover:text-[#5C8F3A] text-4xl font-bold nav-link-mobile relative group"
        >
            Notre Savoir Faire
            <span
                class={`absolute bottom-0 left-0 h-0.5 bg-[#5C8F3A] transition-all duration-300 ${currentPath === "/savoir-faire" || currentPath === "/savoir-faire/" ? "w-full group-hover/mobile:w-0" : "w-0"} group-hover:!w-full`}
            ></span>
        </a>
        <a
            href="/realisations"
            class="text-[#B8B8B8] hover:text-[#5C8F3A] text-3xl font-bold nav-link-mobile relative group"
        >
            Nos Réalisations
            <span
                class={`absolute bottom-0 left-0 h-0.5 bg-[#5C8F3A] transition-all duration-300 ${currentPath === "/realisations" || currentPath === "/realisations/" ? "w-full group-hover/mobile:w-0" : "w-0"} group-hover:!w-full`}
            ></span>
        </a>
        <a
            href="/contact"
            class="text-[#B8B8B8] hover:text-[#5C8F3A] text-4xl font-bold nav-link-mobile relative group"
        >
            Contact
            <span
                class={`absolute bottom-0 left-0 h-0.5 bg-[#5C8F3A] transition-all duration-300 ${currentPath === "/contact" || currentPath === "/contact/" ? "w-full group-hover/mobile:w-0" : "w-0"} group-hover:!w-full`}
            ></span>
        </a>
    </div>
</nav>

<script>
    const menuBtn = document.getElementById("mobile-menu-btn");
    const mobileMenu = document.getElementById("mobile-menu");
    const spans = menuBtn?.querySelectorAll("span");
    const body = document.body;
    let isOpen = false;

    menuBtn?.addEventListener("click", () => {
        isOpen = !isOpen;

        if (isOpen) {
            mobileMenu?.classList.remove("translate-x-full");
            body.style.overflow = "hidden";

            spans?.[0].classList.add("rotate-45");
            spans?.[1].classList.add("opacity-0");
            spans?.[2].classList.add("-rotate-45");

            // Ensure spans are white on black background
            spans?.forEach((span) => {
                span.classList.add("bg-white");
                span.classList.remove("bg-black");
            });
        } else {
            mobileMenu?.classList.add("translate-x-full");
            body.style.overflow = "";

            spans?.[0].classList.remove("rotate-45");
            spans?.[1].classList.remove("opacity-0");
            spans?.[2].classList.remove("-rotate-45");

            // Ensure spans remain white
            spans?.forEach((span) => {
                span.classList.add("bg-white");
                span.classList.remove("bg-black");
            });
        }
    });

    document.querySelectorAll(".nav-link-mobile").forEach((link) => {
        link.addEventListener("click", () => {
            isOpen = false;
            mobileMenu?.classList.add("translate-x-full");
            body.style.overflow = "";
            spans?.[0].classList.remove("rotate-45");
            spans?.[1].classList.remove("opacity-0");
            spans?.[2].classList.remove("-rotate-45");

            // Ensure spans remain white
            spans?.forEach((span) => {
                span.classList.add("bg-white");
                span.classList.remove("bg-black");
            });
        });
    });
</script>
