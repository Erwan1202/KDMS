---
import Layout from "../layouts/Layout.astro";
import Navbar from "../components/common/Navbar.astro";
import ExpertiseSection from "../components/AccueilSections/ExpertiseSection.astro";
import RealisationsSection from "../components/AccueilSections/RealisationsSection.astro";
import ContactSection from "../components/AccueilSections/ContactSection.astro";
import Footer from "../components/common/Footer.astro";
---

<Layout title="KDMS">
    <Navbar />

    <div class="main-wrapper bg-black w-full overflow-x-hidden">
        <section
            id="hero-section"
            class="min-h-[115vh] md:min-h-screen w-full min-w-full relative overflow-hidden flex flex-col items-center justify-center bg-white"
        >
            <img
                id="hero-bg"
                src="/hero-bg.jpg"
                alt="Atelier KDMS"
                class="absolute inset-0 w-full h-full object-cover blur-[2px] z-0 opacity-30 brightness-75"
            />
            <div
                class="hero-text text-center mb-36 md:mb-72 z-20 relative w-full max-w-5xl mx-auto px-8"
            >
                <h1
                    class="text-6xl sm:text-7xl md:text-9xl font-bold text-black tracking-tight"
                >
                    KDMS
                </h1>
                <p
                    class="text-base sm:text-xl md:text-2xl text-black mt-4 uppercase tracking-[0.2em] font-medium px-4"
                >
                    Le flight case 100% custom
                </p>
            </div>
            <img
                src="/flight-case.png"
                alt="Flight Case KDMS"
                class="flight-case w-[90vw] md:w-[70vw] object-contain absolute top-[64%] left-1/2 -translate-x-1/2 -translate-y-1/2 z-10"
            />

            <div
                class="scroll-indicator absolute bottom-[20vh] md:bottom-8 left-1/2 -translate-x-1/2 z-10 animate-bounce flex flex-col items-center gap-3 cursor-pointer"
            >
                <span
                    class="text-black text-[10px] md:text-xs uppercase tracking-[0.2em] font-bold opacity-80"
                    >Scroll</span
                >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="text-black/80"
                >
                    <path d="M7 13l5 5 5-5"></path>
                    <path d="M7 6l5 5 5-5"></path>
                </svg>
            </div>
        </section>

        <section
            id="content-section"
            class="bg-black text-white min-h-screen relative z-20 -mt-1"
        >
            <ExpertiseSection />
            <RealisationsSection />
            <ContactSection />
            <Footer />
        </section>
    </div>
</Layout>

<script>
    import { gsap } from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";
    import { ScrollToPlugin } from "gsap/ScrollToPlugin";

    gsap.registerPlugin(ScrollTrigger, ScrollToPlugin);

    const heroSection = document.querySelector("#hero-section");
    const flightCase = document.querySelector(".flight-case");
    const logoBlack = document.querySelector(".logo-black");
    const logoWhite = document.querySelector(".logo-white");
    const navLinks = document.querySelectorAll(".nav-link");
    const heroText = document.querySelector(".hero-text");

    if (heroSection && flightCase) {
        const navbarBg = document.querySelector(".navbar-bg") as HTMLElement;
        const scrollSpan = document.querySelector(".scroll-indicator span");
        const scrollSvg = document.querySelector(".scroll-indicator svg");

        const timeline = gsap.timeline({
            scrollTrigger: {
                trigger: heroSection,
                start: "top top",
                end: "+=80%",
                pin: true,
                scrub: 1,
                onUpdate: (self) => {
                    if (self.progress > 0.35) {
                        logoBlack?.classList.add("opacity-0");
                        logoWhite?.classList.remove("opacity-0");
                        navLinks.forEach((link) => {
                            link.classList.remove("text-black");
                            link.classList.add("text-white");
                        });
                        if (navbarBg)
                            navbarBg.style.backgroundColor = "rgb(0, 0, 0)";
                    } else {
                        logoBlack?.classList.remove("opacity-0");
                        logoWhite?.classList.add("opacity-0");
                        navLinks.forEach((link) => {
                            link.classList.remove("text-white");
                            link.classList.add("text-black");
                        });
                        if (navbarBg)
                            navbarBg.style.backgroundColor = "transparent";
                    }

                    if (self.progress > 0.4) {
                        scrollSpan?.classList.remove("text-black");
                        scrollSpan?.classList.add("text-white");
                        scrollSvg?.classList.remove("text-black/80");
                        scrollSvg?.classList.add("text-white");
                    } else {
                        scrollSpan?.classList.add("text-black");
                        scrollSpan?.classList.remove("text-white");
                        scrollSvg?.classList.add("text-black/80");
                        scrollSvg?.classList.remove("text-white");
                    }

                    if (self.progress > 0.9) {
                        heroSection.classList.remove("bg-white");
                        heroSection.classList.add("bg-black");
                    } else {
                        heroSection.classList.add("bg-white");
                        heroSection.classList.remove("bg-black");
                    }
                },
            },
        });

        timeline.to(
            heroText,
            {
                y: -300,
                scale: 1.5,
                opacity: 0,
                ease: "power2.in",
                duration: 0.4,
            },
            0,
        );

        const viewportSize = Math.max(window.innerWidth, window.innerHeight);
        const imageWidth =
            window.innerWidth >= 768
                ? window.innerWidth * 0.5
                : window.innerWidth * 0.75;
        // Increase scale factor to ensure we zoom "inside" the case (dark center fills screen)
        const targetScale = (viewportSize / imageWidth) * 25;

        timeline.to(
            flightCase,
            {
                scale: targetScale,
                transformOrigin: "center 65%",
                ease: "power2.inOut",
                duration: 1,
            },
            0,
        );

        const scrollIndicator = document.querySelector(".scroll-indicator");
        if (scrollIndicator) {
            scrollIndicator.addEventListener("click", () => {
                const contentSection =
                    document.querySelector("#content-section");
                if (contentSection) {
                    gsap.to(window, {
                        duration: 2.5,
                        scrollTo: { y: contentSection, offsetY: 0 },
                        ease: "power2.inOut",
                    });
                }
            });

            timeline.to(
                scrollIndicator,
                {
                    opacity: 0,
                    duration: 0.05,
                    ease: "power1.out",
                },
                0.99,
            );
        }
    }
</script>
