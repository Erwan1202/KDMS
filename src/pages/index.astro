---
import Layout from "../layouts/Layout.astro";
import Navbar from "../components/common/Navbar.astro";
import ExpertiseSection from "../components/AccueilSections/ExpertiseSection.astro";
import RealisationsSection from "../components/AccueilSections/RealisationsSection.astro";
import ContactSection from "../components/AccueilSections/ContactSection.astro";
import Footer from "../components/common/Footer.astro";
import { Image } from "astro:assets";
import heroBg from "../assets/accueil/index-hero-bg.jpg";
import heroFlightCase from "../assets/accueil/index-flight-case.png";
---

<Layout title="KDMS">
    <Navbar />

    <div class="main-wrapper bg-black w-full overflow-x-hidden">
        <section
            id="hero-section"
            class="h-screen w-full relative overflow-hidden flex flex-col items-center bg-[#0E0E0E]"
        >
            <Image
                id="hero-bg"
                src={heroBg}
                alt="Atelier KDMS"
                loading="eager"
                fetchpriority="high"
                class="absolute inset-0 w-full h-full object-cover blur-[2px] z-0 brightness-[0.4]"
                decoding="async"
            />
            <div class="absolute inset-0 bg-black/60 z-[1] pointer-events-none">
            </div>

            <div
                class="relative z-20 w-full h-full flex flex-col items-center justify-center pt-16 sm:pt-20 lg:pt-24 pb-8 sm:pb-12"
            >
                <div
                    class="hero-text text-center w-full max-w-[90%] md:max-w-[70%] lg:max-w-[60%] mx-auto px-4"
                >
                    <h1
                        class="font-bold text-white tracking-tight text-[clamp(2.5rem,8vw,7rem)] leading-none"
                    >
                        K-DMS
                    </h1>
                    <p
                        class="mt-1 uppercase tracking-[0.15em] md:tracking-[0.2em] font-medium px-2 md:px-4 text-[clamp(0.75rem,1.5vw,1.8rem)]"
                    >
                        <span class="text-[#B8B8B8]">Le flight case</span>
                        <span class="text-[#4A5D23] font-bold">100% custom</span
                        >
                    </p>
                </div>

                <Image
                    src={heroFlightCase}
                    alt="Flight Case KDMS"
                    loading="eager"
                    fetchpriority="high"
                    class="flight-case w-auto h-[clamp(200px,42vh,450px)] max-w-[95vw] object-contain block my-4"
                    decoding="async"
                />

                <div
                    class="scroll-indicator flex flex-col items-center gap-1 cursor-pointer animate-bounce"
                >
                    <span
                        class="text-[#4A5D23] text-xs uppercase tracking-[0.2em] font-bold"
                        >Scroll</span
                    >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        class="text-[#4A5D23]"
                    >
                        <path d="M7 13l5 5 5-5"></path>
                        <path d="M7 6l5 5 5-5"></path>
                    </svg>
                </div>
            </div>
        </section>
        <div
            id="black-overlay"
            class="absolute inset-0 bg-black opacity-0 z-10 pointer-events-none"
        >
        </div>
    </div>

    <section
        id="content-section"
        class="bg-black text-white min-h-screen relative z-20"
    >
        <ExpertiseSection />
        <RealisationsSection />
        <ContactSection />
        <Footer />
    </section>
</Layout>

<script>
    import { gsap } from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";
    import { ScrollToPlugin } from "gsap/ScrollToPlugin";

    gsap.registerPlugin(ScrollTrigger, ScrollToPlugin);

    const heroSection = document.querySelector("#hero-section");
    const flightCase = document.querySelector(".flight-case");
    const logoBlack = document.querySelector(".logo-black");
    const logoWhite = document.querySelector(".logo-white");
    const navLinks = document.querySelectorAll(".nav-link");
    const heroText = document.querySelector(".hero-text");

    if (heroSection && flightCase) {
        const navbarBg = document.querySelector(".navbar-bg") as HTMLElement;
        const scrollSpan = document.querySelector(".scroll-indicator span");
        const scrollSvg = document.querySelector(".scroll-indicator svg");

        const timeline = gsap.timeline({
            scrollTrigger: {
                trigger: heroSection,
                start: "top top",
                end: "+=50%",
                pin: true,
                scrub: 0.5,
                snap: {
                    snapTo: (progress) => {
                        return progress > 0.02 ? 1 : 0;
                    },
                    duration: { min: 0.3, max: 1.0 },
                    delay: 0,
                    ease: "power2.inOut",
                },
            },
        });

        timeline.fromTo(
            heroText,
            {
                opacity: 1,
                y: 0,
                scale: 1,
            },
            {
                y: -300,
                scale: 1.5,
                opacity: 0,
                ease: "power2.in",
                duration: 0.4,
            },
            0,
        );

        const viewportSize = Math.max(window.innerWidth, window.innerHeight);
        const imageWidth =
            window.innerWidth >= 768
                ? window.innerWidth * 0.5
                : window.innerWidth * 0.75;
        const targetScale = (viewportSize / imageWidth) * 25;

        timeline.fromTo(
            flightCase,
            {
                scale: 1,
                opacity: 1,
            },
            {
                scale: targetScale,
                transformOrigin: "center 60%",
                ease: "power2.inOut",
                duration: 1,
            },
            0,
        );

        const scrollIndicator = document.querySelector(".scroll-indicator");
        const blackOverlay = document.querySelector("#black-overlay");

        if (scrollIndicator) {
            scrollIndicator.addEventListener("click", () => {
                const contentSection =
                    document.querySelector("#content-section");
                if (contentSection) {
                    gsap.to(window, {
                        duration: 2.5,
                        scrollTo: { y: contentSection, offsetY: 0 },
                        ease: "power2.inOut",
                    });
                }
            });

            timeline.fromTo(
                scrollIndicator,
                {
                    opacity: 1,
                },
                {
                    opacity: 0,
                    duration: 0.05,
                    ease: "power1.out",
                },
                0.99,
            );
        }

        if (blackOverlay) {
            timeline.to(
                blackOverlay,
                {
                    opacity: 1,
                    duration: 0.2,
                    ease: "power2.inOut",
                },
                0.8,
            );
        }

        timeline.to(
            navbarBg,
            {
                autoAlpha: 1,
                duration: 0.5,
                ease: "power2.out",
            },
            0.9,
        );
    }
</script>
