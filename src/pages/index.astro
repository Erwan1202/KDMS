---
import Layout from "../layouts/Layout.astro";
import Navbar from "../components/common/Navbar.astro";
import ExpertiseSection from "../components/AccueilSections/ExpertiseSection.astro";
import RealisationsSection from "../components/AccueilSections/RealisationsSection.astro";
import ContactSection from "../components/AccueilSections/ContactSection.astro";
import Footer from "../components/common/Footer.astro";
import { Image } from "astro:assets";
import heroBg from "../assets/accueil/index-hero-bg.jpg";
import heroFlightCase from "../assets/accueil/index-flight-case.png";
---

<Layout title="KDMS">
    <Navbar />

    <div class="main-wrapper bg-black w-full overflow-x-hidden">
        <section
            id="hero-section"
            class="min-h-screen w-full min-w-full relative overflow-hidden flex flex-col items-center justify-center gap-[4vh] bg-white pt-32"
        >
            <Image
                id="hero-bg"
                src={heroBg}
                alt="Atelier KDMS"
                loading="eager"
                fetchpriority="high"
                class="absolute inset-0 w-full h-full object-cover blur-[2px] z-0 opacity-30 brightness-75"
                fetchpriority="high"
                loading="eager"
                decoding="async"
            />
            <div
                class="hero-text text-center z-20 relative w-full max-w-[60vw] mx-auto px-4"
            >
                <h1
                    class="font-bold text-black tracking-tight text-[clamp(3.5rem,10vw,8rem)] leading-none"
                >
                    KDMS
                </h1>
                <p
                    class="text-black mt-1 uppercase tracking-[0.2em] font-medium px-4 text-[clamp(0.9rem,2vw,1.8rem)]"
                >
                    Le flight case 100% custom
                </p>
            </div>
            <Image
                src={heroFlightCase}
                alt="Flight Case KDMS"
                loading="eager"
                fetchpriority="high"
                class="flight-case w-[95vw] md:w-[85vw] object-contain relative z-10 block md:-mt-[8vh]"
                loading="eager"
                decoding="async"
            />

            <div
                class="scroll-indicator absolute bottom-[8vh] md:bottom-8 left-1/2 -translate-x-1/2 z-10 animate-bounce flex flex-col items-center gap-3 cursor-pointer"
            >
                <span
                    class="text-black text-xs md:text-sm uppercase tracking-[0.2em] font-bold opacity-80"
                    >Scroll</span
                >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="text-black/80"
                >
                    <path d="M7 13l5 5 5-5"></path>
                    <path d="M7 6l5 5 5-5"></path>
                </svg>
            </div>
        </section>
        <div
            id="black-overlay"
            class="absolute inset-0 bg-black opacity-0 z-10 pointer-events-none"
        >
        </div>
    </div>

    <section
        id="content-section"
        class="bg-black text-white min-h-screen relative z-20"
    >
        <ExpertiseSection />
        <RealisationsSection />
        <ContactSection />
        <Footer />
    </section>
</Layout>

<script>
    import { gsap } from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";
    import { ScrollToPlugin } from "gsap/ScrollToPlugin";

    gsap.registerPlugin(ScrollTrigger, ScrollToPlugin);

    const heroSection = document.querySelector("#hero-section");
    const flightCase = document.querySelector(".flight-case");
    const logoBlack = document.querySelector(".logo-black");
    const logoWhite = document.querySelector(".logo-white");
    const navLinks = document.querySelectorAll(".nav-link");
    const heroText = document.querySelector(".hero-text");

    if (heroSection && flightCase) {
        const navbarBg = document.querySelector(".navbar-bg") as HTMLElement;
        const scrollSpan = document.querySelector(".scroll-indicator span");
        const scrollSvg = document.querySelector(".scroll-indicator svg");

        const timeline = gsap.timeline({
            scrollTrigger: {
                trigger: heroSection,
                start: "top top",
                end: "+=50%",
                pin: true,
                scrub: 0.5,
                onUpdate: (self) => {
                    if (self.progress > 0.35) {
                        logoBlack?.classList.add("opacity-0");
                        logoWhite?.classList.remove("opacity-0");
                        navLinks.forEach((link) => {
                            link.classList.remove("text-black");
                            link.classList.add("text-white");
                        });
                        if (navbarBg)
                            navbarBg.style.backgroundColor = "rgb(0, 0, 0)";
                    } else {
                        logoBlack?.classList.remove("opacity-0");
                        logoWhite?.classList.add("opacity-0");
                        navLinks.forEach((link) => {
                            link.classList.remove("text-white");
                            link.classList.add("text-black");
                        });
                        if (navbarBg)
                            navbarBg.style.backgroundColor = "transparent";
                    }

                    if (self.progress > 0.4) {
                        scrollSpan?.classList.remove("text-black");
                        scrollSpan?.classList.add("text-white");
                        scrollSvg?.classList.remove("text-black/80");
                        scrollSvg?.classList.add("text-white");
                    } else {
                        scrollSpan?.classList.add("text-black");
                        scrollSpan?.classList.remove("text-white");
                        scrollSvg?.classList.add("text-black/80");
                        scrollSvg?.classList.remove("text-white");
                    }

                    if (self.progress > 0.9) {
                        heroSection.classList.remove("bg-white");
                        heroSection.classList.add("bg-black");
                    } else {
                        heroSection.classList.add("bg-white");
                        heroSection.classList.remove("bg-black");
                    }
                },
            },
        });

        timeline.to(
            heroText,
            {
                y: -300,
                scale: 1.5,
                opacity: 0,
                ease: "power2.in",
                duration: 0.4,
            },
            0,
        );

        const viewportSize = Math.max(window.innerWidth, window.innerHeight);
        const imageWidth =
            window.innerWidth >= 768
                ? window.innerWidth * 0.5
                : window.innerWidth * 0.75;
        const targetScale = (viewportSize / imageWidth) * 25;

        timeline.to(
            flightCase,
            {
                scale: targetScale,
                transformOrigin: "center 65%",
                ease: "power2.inOut",
                duration: 1,
            },
            0,
        );

        const preloaderText = document.querySelector("#preloader-text");
        const scrollIndicator = document.querySelector(".scroll-indicator");
        const blackOverlay = document.querySelector("#black-overlay");
        if (scrollIndicator) {
            scrollIndicator.addEventListener("click", () => {
                const contentSection =
                    document.querySelector("#content-section");
                if (contentSection) {
                    gsap.to(window, {
                        duration: 2.5,
                        scrollTo: { y: contentSection, offsetY: 0 },
                        ease: "power2.inOut",
                    });
                }
            });

            timeline.to(
                scrollIndicator,
                {
                    opacity: 0,
                    duration: 0.05,
                    ease: "power1.out",
                },
                0.99,
            );
        }
    }
</script>
